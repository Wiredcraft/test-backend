# ä¸€ã€å®‰è£…ä¾èµ–ä»¥åŠè¿è¡Œ

1. å®‰è£…ä¾èµ–ï¼šcd åˆ°æ ¹ç›®å½•ä¹‹åï¼Œä½¿ç”¨ `yarn` å‘½ä»¤æ¥å®‰è£…æ‰€æœ‰ä¾èµ–ã€‚

```shell
MacBook-Pro:test-backend frank$ yarn 
yarn install v1.17.3
[1/4] ğŸ”  Resolving packages...
success Already up-to-date.
âœ¨  Done in 0.27s.
MacBook-Pro:test-backend frank$ 
```

2. è¿è¡Œï¼šæ‚¨å¯ä»¥çœ‹åˆ° `package.json` ä¸­çš„ `script`ï¼Œæ­£å¦‚æ‚¨æ‰€è§ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

```
MacBook-Pro:test-backend frank$ yarn run start
yarn run v1.17.3
$ rm -rf /dist && tsc && node ./dist/app.js
(node:30079) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect.
(node:30079) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.
Mongoose connected to mongodb://localhost:27017/test
```



# äºŒã€ç¼–å†™æµç¨‹

## 1. é…ç½®æ–‡ä»¶

åœ¨ç¼–å†™ä¹‹å‰ï¼Œæ‚¨å¯ä»¥åœ¨ `./config` æ–‡ä»¶å¤¹ä¸­æ·»åŠ æ‚¨æ‰€éœ€è¦çš„ä»»ä½•é…ç½®æ–‡ä»¶ã€‚

## 2.Schemaä¸model

1. å¦‚æœæ‚¨éœ€è¦è®¾è®¡ `Schema`ï¼Œæ‚¨éœ€è¦å…ˆåœ¨ `./model/types`ä¸­å®šä¹‰å®ƒçš„å­—æ®µï¼Œæˆ‘ä»¬ç¡®ä¿ä½¿ç”¨è¯¥ç±»ã€‚
2. åœ¨ `./model/entity`ä¸­æ·»åŠ æ‚¨çš„ `schema`æ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥æŸ¥çœ‹å·²ç»ç¼–å†™å¥½çš„å®ä¾‹ï¼Œæˆ–è®¸å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚

## 3. ç¡®è®¤APIçš„å‚æ•°ã€è¿”å›å€¼ã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹

å½“æ‚¨è®¾è®¡å¥½ç¼–å†™APIæ€è·¯æ—¶ï¼Œæ‚¨åŠ¡å¿…å…ˆç¡®è®¤è¯¥APIçš„å‚æ•°ã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ã€è¿”å›å€¼ç±»å‹ï¼Œå¹¶ä¸”åœ¨ `./types`æ–‡ä»¶å¤¹ä¸­æ·»åŠ å¯¹åº”çš„ `interface ` ï¼Œæ‚¨ä¹Ÿå¯ä»¥æŸ¥çœ‹å·²ç¼–å†™å¥½çš„å®ä¾‹ï¼Œæˆ–è®¸å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚

## 4. Service

æ‚¨å¯ä»¥åœ¨ `./service` æ–‡ä»¶å¤¹ä¸­ç¼–å†™æœ‰å…³çš„æ–¹æ³•

## 5. Controller

1. æ‚¨éœ€è¦åœ¨ `./controller` ä¸­ç¼–å†™ `router`ï¼ŒæŸ¥çœ‹å®ä¾‹æˆ–è®¸ä¹Ÿä¼šå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚

2. ç¼–å†™å®Œæˆä¹‹åï¼Œæ‚¨å¿…é¡»åœ¨ `./app.ts` æ–‡ä»¶ä¸­å¼•å…¥è·¯ç”±ï¼Œä¾‹å¦‚
 ```js
   // api.ts
   
   import usersRouter from './routers/users.controller'
   // ...
   const app = express() // #
   // ...
   app.use('/api/users', usersRouter)  // è¯¥è¡Œä»£ç å¿…é¡»åœ¨ ä¸Šè¿° # ä»£ç ä¹‹å
 ```
3. **â˜…å€¼å¾—æ³¨æ„çš„æ˜¯è¯¥é¡¹ç›®çš„ `token`ä¼ é€’æ–¹å¼**ï¼Œæ‚¨å¯ä»¥æ»‘åˆ°ç¬¬ä¸ƒæ¡ `postman`æ¥æŸ¥çœ‹å¯¹åº”çš„ç­–ç•¥

##6. æˆ–è®¸æ‚¨å¯èƒ½éœ€è¦ç¼–å†™æµ‹è¯•ç”¨ä¾‹

æ²¡å…³ç³»ï¼Œè®©æˆ‘ä»¬åœ¨ `./test` æ–‡ä»¶ä¸­ç¼–å†™å®ƒä»¬ï¼å½“æ‚¨ç¼–å†™å®Œæµ‹è¯•ç”¨ä¾‹ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•ï¼š

```js
MacBook-Pro:test-backend frank$ yarn run test
yarn run v1.17.3
$ mocha "./{,!(node_modules)/**/}*.test.ts"
  service.user:
Mongoose connected to mongodb://localhost:27017/test
    âœ“ should create user (54ms)


  1 passing (62ms)
```

æ­£å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨çš„ä»£ç é€šè¿‡äº†æµ‹è¯•ç”¨ä¾‹ã€‚



## 7. PostManæµ‹è¯•

> Noteï¼šè¯·æ³¨æ„ï¼Œå·²å­˜åœ¨çš„å¤§éƒ¨åˆ†æ¥å£éœ€è¦ä¼ é€’Tokenã€‚
>
> **token**å‰é¢è¦åŠ å‰ç¼€ï¼š Bearer xxxxxx ï¼ˆæ³¨æ„Bearerå’Œtokenä¹‹é—´æœ‰ï¼‰

![nT4yHe.png](https://s2.ax1x.com/2019/09/18/nT4yHe.png)

